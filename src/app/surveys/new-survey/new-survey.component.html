<form [formGroup]="newSurveyFormGroup" (ngSubmit)="onSubmit()">
  <div class="form-group">
    <input class="form-control" formControlName="surveyName" placeholder="Enter survey name"
           [ngClass]="{ 'is-invalid': submitted && surveyName.errors }"/>
    <div *ngIf="submitted && surveyName.errors" class="invalid-feedback">
      <div *ngIf="surveyName.errors.required">Survey name is required</div>
    </div>
  </div>
  <div class="form-group">
    <textarea class="form-control text-md" formControlName="surveyDescription"
              placeholder="Enter brief description"></textarea>
  </div>
  <hr/>
  <div class="form-group">
    <input class="form-control" formControlName="elapseDate" placeholder="Enter elapse date"
           [ngClass]="{ 'is-invalid': submitted && elapseDate.errors}"/>
    <div *ngIf="submitted && elapseDate.errors" class="invalid-feedback">
      <div *ngIf="elapseDate.errors.required">
        Elapse date is required
      </div>
      <div *ngIf="elapseDate.errors.pattern">
        Date must be in format: dd.MM.yyyy
      </div>
    </div>
  </div>
  <div formArrayName="questions">
    <div class="form-group" *ngFor="let question of questions.controls; let i = index" [formGroupName]="i">
      <ul class="list-inline">
        <li class="list-inline-item">
          <input class="form-control" [formControl]="question.controls['questionName']"
                 [ngClass]="{ 'is-invalid': submitted && question.controls['questionName'].errors }"
                 placeholder="Question name">
          <div *ngIf="submitted && question.controls['questionName'].errors" class="invalid-feedback">
            <div *ngIf="question.controls['questionName'].errors.required">Question is required</div>
          </div>
        </li>
        <li class="list-inline-item"> <!--ngbDropdown=""-->
          <select class="form-control custom-select" [formControl]="question.controls['questionType']"
                  (change)="pickAnswerType($event, question)">
            <option value="">Choose...</option>
            <option *ngFor="let q of questionTypes" [ngValue]="q">
              {{q}}
            </option>
          </select>
        </li>
      </ul>
      <div formArrayName="answers">
        <div class="form-group" *ngFor="let answer of question.get('answers').controls; let answerIndex = index"
             [formGroupName]="answerIndex">
          <div *ngIf="question.controls['questionType'].value.toString()==='single-choice'">
            <div class="row">
              <button class="col-md-1 btn btn-danger" (click)="deleteAnswer(question, answerIndex)"> x</button>
              <div class="col-md-1">
                <img src="../../../assets/images/radioIcon2.png">
              </div>
              <div class="col-md-10">
                <input class="form-control" [formControl]="answer.controls['answerName']"
                       [ngClass]="{ 'is-invalid': submitted && answer.controls['answerName'].errors }"
                       placeholder="Radio-answer text"/>
                <div *ngIf="submitted && answer.controls['answerName'].errors" class="invalid-feedback">
                  <div *ngIf="answer.controls['answerName'].errors.required">Answer is required</div>
                </div>
              </div>
            </div>
            <div *ngIf="answerIndex==question.get('answers').controls.length-1" class="clearfix text-right">
              <button class="btn btn-info"
                      (click)="addAnswer(question)"> +
              </button>
            </div>
          </div>
          <div *ngIf="question.controls['questionType'].value.toString()==='multiple-choice'">
            <div class="row">
              <button class="col-md-1 btn btn-danger btn-block" (click)="deleteAnswer(question, answerIndex)"> x</button>
              <div class="col-md-1">
                <img src="../../../assets/images/checkBoxIcon2.png">
              </div>
              <div class="col-md-10">
                <input class="form-control" [formControl]="answer.controls['answerName']"
                       [ngClass]="{ 'is-invalid': submitted && answer.controls['answerName'].errors }"
                       placeholder="Checkbox-answer text"/>
                <div *ngIf="submitted && answer.controls['answerName'].errors" class="invalid-feedback">
                  <div *ngIf="answer.controls['answerName'].errors.required">Answer is required</div>
                </div>
              </div>
            </div>
            <div *ngIf="answerIndex==question.get('answers').controls.length-1" class="clearfix text-right">
              <button class="btn btn-info"
                      (click)="addAnswer(question)"> +
              </button>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="i == questions.length-1" class="clearfix text-right">
        <button class="btn btn-info" type="button" (click)="addQuestion();">Add question</button>
      </div>
    </div>
  </div>

  <ul class="list-inline">
    <li class="list-inline-item">
      <button class="btn btn-dark" (click)="cancelCreation()">Cancel</button>
    </li>
    <li class="list-inline-item">
      <button class="btn btn-primary" type="submit">Save as a draft</button>
    </li>
    <li class="list-inline-item">
      <button class="btn btn-primary" type="submit">Create</button>
    </li>
  </ul>
</form>
